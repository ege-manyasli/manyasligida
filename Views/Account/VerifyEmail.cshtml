@{
    ViewData["Title"] = "E-posta Doğrulama";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-4">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-primary text-white text-center">
                    <h4><i class="fas fa-envelope-check me-2"></i>E-posta Doğrulama</h4>
                </div>
                <div class="card-body p-4">
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>@ViewBag.Email</strong> adresine gönderilen doğrulama kodunu girin.
                    </div>
                    
                    @if (TempData["Success"] != null)
                    {
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle me-2"></i>@TempData["Success"]
                        </div>
                    }
                    
                    @if (TempData["Error"] != null)
                    {
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-circle me-2"></i>@TempData["Error"]
                        </div>
                    }

                    <form asp-action="VerifyEmail" method="post">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="email" value="@ViewBag.Email" />
                        
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>
                        
                        <div class="form-group mb-3">
                            <label for="verificationCode" class="form-label">
                                <i class="fas fa-key me-1"></i>Doğrulama Kodu
                            </label>
                            <input type="text" 
                                   class="form-control form-control-lg text-center" 
                                   id="verificationCode" 
                                   name="verificationCode" 
                                   placeholder="6 haneli kod" 
                                   maxlength="6"
                                   required 
                                   autocomplete="off"
                                   style="letter-spacing: 0.5em; font-weight: bold;">
                            <div class="form-text">E-posta kutunuzu kontrol edin ve 6 haneli kodu girin.</div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-lg w-100 mb-3">
                            <i class="fas fa-check me-2"></i>Doğrula
                        </button>
                    </form>

                    <div class="text-center">
                        <form asp-action="ResendVerificationCode" method="post" style="display: inline;">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="email" value="@ViewBag.Email" />
                            <button type="submit" class="btn btn-outline-secondary">
                                <i class="fas fa-redo me-1"></i>Kodu Tekrar Gönder
                            </button>
                        </form>
                    </div>

                    <hr>
                    
                    <div class="text-center">
                        <p class="text-muted mb-0">
                            Başka bir e-posta adresi ile kayıt olmak mı istiyorsunuz?
                        </p>
                        <a href="@Url.Action("Register", "Account")" class="btn btn-link">
                            <i class="fas fa-user-plus me-1"></i>Yeni Kayıt
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Auto focus on verification code input
            $('#verificationCode').focus();
            
            // Auto-format verification code (only numbers, max 6 digits)
            $('#verificationCode').on('input', function() {
                let value = $(this).val().replace(/\D/g, ''); // Only digits
                if (value.length > 6) {
                    value = value.substring(0, 6);
                }
                $(this).val(value);
            });
            
            // Submit form when 6 digits entered
            $('#verificationCode').on('input', function() {
                if ($(this).val().length === 6) {
                    // Small delay to show the complete code
                    setTimeout(function() {
                        $('form').first().submit();
                    }, 500);
                }
            });
        });
    </script>
}

<style>
    .card {
        border-radius: 15px;
    }
    
    .card-header {
        border-radius: 15px 15px 0 0;
    }
    
    #verificationCode {
        border: 2px solid #dee2e6;
        transition: all 0.3s ease;
    }
    
    #verificationCode:focus {
        border-color: #0d6efd;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }
    
    .btn {
        border-radius: 10px;
        transition: all 0.3s ease;
    }
    
    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
</style>