@{
    ViewData["Title"] = "E-posta Test";
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">E-posta Test SayfasÄ±</h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <h5>Test SonuÃ§larÄ±:</h5>
                        <div id="testResults">
                            <p>Test sonuÃ§larÄ± burada gÃ¶rÃ¼necek...</p>
                        </div>
                    </div>

                                         <div class="row">
                         <div class="col-md-3">
                             <button class="btn btn-success btn-block mb-3" onclick="testEmailConfig()">
                                 ğŸ“§ E-posta AyarlarÄ±nÄ± Test Et
                             </button>
                         </div>
                         <div class="col-md-3">
                             <button class="btn btn-warning btn-block mb-3" onclick="testEmailSend()">
                                 ğŸ“¤ Test E-postasÄ± GÃ¶nder
                             </button>
                         </div>
                         <div class="col-md-3">
                             <button class="btn btn-danger btn-block mb-3" onclick="testGmailConnection()">
                                 ğŸ”— Gmail BaÄŸlantÄ±sÄ±nÄ± Test Et
                             </button>
                         </div>
                         <div class="col-md-3">
                             <a href="/Account/Test" class="btn btn-info btn-block mb-3">
                                 ğŸ”„ SayfayÄ± Yenile
                             </a>
                         </div>
                     </div>

                    <div class="mt-4">
                        <h5>E-posta KonfigÃ¼rasyonu:</h5>
                        <div id="emailConfig" class="alert alert-secondary">
                            <p>KonfigÃ¼rasyon bilgileri yÃ¼kleniyor...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
async function testEmailConfig() {
    try {
        const response = await fetch('/Account/EmailConfig');
        const data = await response.json();
        
        let html = '<div class="table-responsive"><table class="table table-sm">';
        html += '<tr><td><strong>SMTP Server:</strong></td><td>' + (data.SmtpServer || 'BOÅ') + '</td></tr>';
        html += '<tr><td><strong>SMTP Port:</strong></td><td>' + (data.SmtpPort || 'BOÅ') + '</td></tr>';
        html += '<tr><td><strong>Username:</strong></td><td>' + (data.SmtpUsername || 'BOÅ') + '</td></tr>';
        html += '<tr><td><strong>Password:</strong></td><td>' + (data.SmtpPassword || 'BOÅ') + '</td></tr>';
        html += '<tr><td><strong>From Email:</strong></td><td>' + (data.FromEmail || 'BOÅ') + '</td></tr>';
        html += '<tr><td><strong>Environment:</strong></td><td>' + (data.Environment || 'BOÅ') + '</td></tr>';
        html += '<tr><td><strong>Enable SSL:</strong></td><td>' + (data.EnableSsl || 'BOÅ') + '</td></tr>';
        html += '<tr><td><strong>Use Default Credentials:</strong></td><td>' + (data.UseDefaultCredentials || 'BOÅ') + '</td></tr>';
        html += '<tr><td><strong>Timeout:</strong></td><td>' + (data.Timeout || 'BOÅ') + '</td></tr>';
        html += '<tr><td><strong>Delivery Method:</strong></td><td>' + (data.DeliveryMethod || 'BOÅ') + '</td></tr>';
        html += '<tr><td><strong>Current Time:</strong></td><td>' + (data.CurrentTime || 'BOÅ') + '</td></tr>';
        html += '<tr><td><strong>Server Timezone:</strong></td><td>' + (data.ServerTimeZone || 'BOÅ') + '</td></tr>';
        html += '<tr><td><strong>TÃ¼m Ayarlar Mevcut:</strong></td><td>' + (data.HasAllSettings ? 'âœ… EVET' : 'âŒ HAYIR') + '</td></tr>';
        html += '</table></div>';
        
        document.getElementById('emailConfig').innerHTML = html;
        
        if (data.HasAllSettings) {
            document.getElementById('testResults').innerHTML = '<div class="alert alert-success">âœ… E-posta ayarlarÄ± doÄŸru gÃ¶rÃ¼nÃ¼yor!</div>';
        } else {
            document.getElementById('testResults').innerHTML = '<div class="alert alert-danger">âŒ E-posta ayarlarÄ±nda eksiklikler var!</div>';
        }
    } catch (error) {
        document.getElementById('testResults').innerHTML = '<div class="alert alert-danger">âŒ Hata: ' + error.message + '</div>';
    }
}

async function testEmailSend() {
    try {
        document.getElementById('testResults').innerHTML = '<div class="alert alert-info">ğŸ“¤ Test e-postasÄ± gÃ¶nderiliyor...</div>';
        
        const response = await fetch('/Account/TestEmail');
        const result = await response.json();
        
                 if (result.Success) {
             let successHtml = '<div class="alert alert-success">âœ… Test e-postasÄ± baÅŸarÄ±yla gÃ¶nderildi!</div>';
             successHtml += '<div class="alert alert-info"><strong>Test DetaylarÄ±:</strong><br>';
             successHtml += 'E-posta: ' + result.TestEmail + '<br>';
             successHtml += 'Kod: ' + result.TestCode + '<br>';
             successHtml += 'Ortam: ' + result.Environment + '<br>';
             successHtml += 'Zaman: ' + result.Timestamp + '</div>';
             document.getElementById('testResults').innerHTML = successHtml;
         } else {
             let errorHtml = '<div class="alert alert-danger">âŒ Test e-postasÄ± gÃ¶nderilemedi!</div>';
             errorHtml += '<div class="alert alert-warning"><strong>Hata DetayÄ±:</strong><br>' + result.Message + '</div>';
             errorHtml += '<div class="alert alert-info"><strong>Ortam:</strong> ' + result.Environment + '</div>';
             if (result.Error) {
                 errorHtml += '<div class="alert alert-secondary"><strong>Teknik Hata:</strong><br><small>' + result.Error + '</small></div>';
             }
             document.getElementById('testResults').innerHTML = errorHtml;
         }
    } catch (error) {
        document.getElementById('testResults').innerHTML = '<div class="alert alert-danger">âŒ Hata: ' + error.message + '</div>';
    }
}

async function testGmailConnection() {
    try {
        document.getElementById('testResults').innerHTML = '<div class="alert alert-info">ğŸ”— Gmail baÄŸlantÄ±sÄ± test ediliyor...</div>';
        
        const response = await fetch('/Account/TestGmailConnection');
        const result = await response.json();
        
        if (result.Success) {
            let successHtml = '<div class="alert alert-success">âœ… Gmail baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ±!</div>';
            successHtml += '<div class="alert alert-info"><strong>BaÄŸlantÄ± DetaylarÄ±:</strong><br>';
            successHtml += 'SMTP Server: ' + result.SmtpServer + '<br>';
            successHtml += 'Port: ' + result.Port + '<br>';
            successHtml += 'SSL: ' + (result.SslEnabled ? 'Aktif' : 'Pasif') + '<br>';
            successHtml += 'BaÄŸlantÄ± SÃ¼resi: ' + result.ConnectionTime + 'ms</div>';
            document.getElementById('testResults').innerHTML = successHtml;
        } else {
            let errorHtml = '<div class="alert alert-danger">âŒ Gmail baÄŸlantÄ±sÄ± baÅŸarÄ±sÄ±z!</div>';
            errorHtml += '<div class="alert alert-warning"><strong>Hata:</strong> ' + result.Message + '</div>';
            if (result.Suggestions) {
                errorHtml += '<div class="alert alert-info"><strong>Ã–neriler:</strong><br>' + result.Suggestions + '</div>';
            }
            document.getElementById('testResults').innerHTML = errorHtml;
        }
    } catch (error) {
        document.getElementById('testResults').innerHTML = '<div class="alert alert-danger">âŒ BaÄŸlantÄ± testi hatasÄ±: ' + error.message + '</div>';
    }
}

// Sayfa yÃ¼klendiÄŸinde otomatik olarak konfigÃ¼rasyonu test et
document.addEventListener('DOMContentLoaded', function() {
    testEmailConfig();
});
</script>
