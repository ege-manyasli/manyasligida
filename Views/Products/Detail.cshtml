@model manyasligida.Models.Product
@{
    ViewData["Title"] = $"{Model.Name} - Manyaslı Süt Ürünleri";
}

<!-- Page Header -->
<section class="page-header" style="background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); padding: 120px 0 80px;">
    <div class="container">
        <div class="row justify-content-center text-center">
            <div class="col-lg-8" data-aos="fade-up">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb justify-content-center">
                        <li class="breadcrumb-item"><a href="@Url.Action("Index", "Home")" class="text-white">Ana Sayfa</a></li>
                        <li class="breadcrumb-item"><a href="@Url.Action("Index", "Products")" class="text-white">Ürünler</a></li>
                        <li class="breadcrumb-item active text-warning" aria-current="page">@Model.Name</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</section>

<!-- Product Detail Section -->
<section class="section-padding">
    <div class="container">
        <div class="row">
            <!-- Product Images -->
            <div class="col-lg-6 mb-4" data-aos="fade-right">
                <div class="product-gallery">
                    <div class="main-image-container mb-3">
                        <img id="mainImage" src="@Model.GetMainImageUrl()" class="main-image" alt="@Model.Name">
                        <div class="image-overlay">
                            <button class="btn btn-light btn-sm" onclick="openImageModal()">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                    </div>
                    <div class="thumbnail-container">
                        <div class="thumbnail-images d-flex gap-2 flex-wrap">
                            @{
                                var images = Model.GetImageUrls();
                                if (images == null || images.Count == 0)
                                {
                                    images = new List<string> { Model.ImageUrl ?? "" };
                                }
                            }
                            @for (int i = 0; i < images.Count; i++)
                            {
                                var url = images[i];
                                var active = i == 0 ? "active" : "";
                                <img src="@url" class="thumbnail-img @active" onclick="changeImage(this, '@url')" alt="@Model.Name - @(i+1)">
                            }
                        </div>
                    </div>
                </div>
            </div>

            <!-- Product Info -->
            <div class="col-lg-6" data-aos="fade-left">
                <div class="product-info">
                    <h1 class="product-title fw-bold mb-3">@Model.Name</h1>
                    
                    <!-- Rating -->
                    <div class="rating mb-3">
                        <div class="stars">
                            <i class="fas fa-star text-warning"></i>
                            <i class="fas fa-star text-warning"></i>
                            <i class="fas fa-star text-warning"></i>
                            <i class="fas fa-star text-warning"></i>
                            <i class="fas fa-star text-warning"></i>
                        </div>
                        <span class="ms-2 text-muted">(24 değerlendirme)</span>
                        @if (Model.StockQuantity > 0)
                        {
                            <span class="ms-3 text-success"><i class="fas fa-check-circle"></i> Stokta</span>
                        }
                        else
                        {
                            <span class="ms-3 text-danger"><i class="fas fa-times-circle"></i> Stokta Yok</span>
                        }
                    </div>

                    <!-- Price -->
                    <div class="price-section mb-4">
                        <div class="current-price">₺@Model.Price.ToString("0.00")</div>
                        @if (Model.OldPrice.HasValue && Model.OldPrice > Model.Price)
                        {
                            <div class="old-price text-muted text-decoration-line-through">₺@Model.OldPrice?.ToString("0.00")</div>
                            var discountPercent = ((Model.OldPrice!.Value - Model.Price) / Model.OldPrice.Value * 100).ToString("0");
                            <span class="badge bg-danger ms-2">%@discountPercent İndirim</span>
                        }
                    </div>

                    <!-- Product Details -->
                    <div class="product-details mb-4">
                        <div class="row g-3">
                            <div class="col-6">
                                <div class="detail-item">
                                    <strong>Gramaj:</strong> @Model.Weight
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="detail-item">
                                    <strong>Yağ Oranı:</strong> @Model.FatContent
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="detail-item">
                                    <strong>Kategori:</strong> @Model.Category?.Name
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="detail-item">
                                    <strong>Stok:</strong> @Model.StockQuantity adet
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quantity Selector -->
                    <div class="quantity-selector mb-4">
                        <label class="form-label fw-bold">Adet:</label>
                        <div class="input-group quantity-group">
                            <button class="btn btn-outline-secondary" type="button" onclick="decreaseQuantity()">
                                <i class="fas fa-minus"></i>
                            </button>
                            <input type="number" class="form-control text-center" id="quantity" value="1" min="1" max="10">
                            <button class="btn btn-outline-secondary" type="button" onclick="increaseQuantity()">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="action-buttons mb-4">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <button class="btn btn-primary btn-lg w-100" onclick="addToCart(@Model.Id)" @(Model.StockQuantity <= 0 ? "disabled" : "")>
                                    <i class="fas fa-shopping-cart me-2"></i>@(Model.StockQuantity > 0 ? "Sepete Ekle" : "Stokta Yok")
                                </button>
                            </div>
                            <div class="col-md-6">
                                <a href="@Url.Action("Index", "Cart")" class="btn btn-outline-primary btn-lg w-100">
                                    <i class="fas fa-shopping-bag me-2"></i>Sepetim
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions mb-4">
                        <div class="row g-2">
                            <div class="col-6">
                                <button class="btn btn-outline-secondary w-100" onclick="addToWishlist()">
                                    <i class="far fa-heart me-2"></i>Favorilere Ekle
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-secondary w-100" onclick="shareProduct()">
                                    <i class="fas fa-share me-2"></i>Paylaş
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Delivery Info -->
                    <div class="delivery-info">
                        <div class="card border-0 bg-light">
                            <div class="card-body">
                                <h6 class="card-title fw-bold"><i class="fas fa-truck me-2"></i>Kargo Bilgileri</h6>
                                <p class="card-text mb-2">Ücretsiz kargo (150₺ üzeri alışverişlerde)</p>
                                <p class="card-text mb-0"><small class="text-muted">1-3 iş günü içinde teslimat</small></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Product Description -->
<section class="section-padding bg-light">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <ul class="nav nav-tabs" id="productTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="description-tab" data-bs-toggle="tab" data-bs-target="#description" type="button" role="tab">Açıklama</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="specifications-tab" data-bs-toggle="tab" data-bs-target="#specifications" type="button" role="tab">Özellikler</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab">Yorumlar</button>
                    </li>
                </ul>
                
                <div class="tab-content" id="productTabsContent">
                    <!-- Description Tab -->
                    <div class="tab-pane fade show active" id="description" role="tabpanel">
                        <div class="p-4">
                            <h4 class="fw-bold mb-3">Ürün Açıklaması</h4>
                            <p class="mb-3">
                                @(string.IsNullOrEmpty(Model.Description) ? "Bu ürün hakkında detaylı bilgi yakında eklenecektir." : Model.Description)
                            </p>
                            <h5 class="fw-bold mb-2">Özellikler:</h5>
                            <ul class="mb-3">
                                <li>Kaliteli süt ürünü</li>
                                <li>Geleneksel üretim yöntemi</li>
                                <li>Katkı maddesi içermez</li>
                                <li>Taze ve besleyici</li>
                                <li>Kaliteli hammadde</li>
                                <li>Hijyenik üretim</li>
                            </ul>
                            <h5 class="fw-bold mb-2">Kullanım Alanları:</h5>
                            <p>
                                Kahvaltı sofralarının vazgeçilmezi olan bu ürün, salatalarda, 
                                böreklerde ve çeşitli yemeklerde de kullanılabilir. Özellikle 
                                kahvaltılık olarak tüketildiğinde eşsiz bir lezzet sunar.
                            </p>
                        </div>
                    </div>

                    <!-- Specifications Tab -->
                    <div class="tab-pane fade" id="specifications" role="tabpanel">
                        <div class="p-4">
                            <h4 class="fw-bold mb-3">Teknik Özellikler</h4>
                            <div class="row">
                                <div class="col-md-6">
                                    <table class="table table-borderless">
                                        <tbody>
                                            <tr>
                                                <td><strong>Ürün Adı:</strong></td>
                                                <td>@Model.Name</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Gramaj:</strong></td>
                                                <td>@Model.Weight</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Yağ Oranı:</strong></td>
                                                <td>@Model.FatContent</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Kategori:</strong></td>
                                                <td>@Model.Category?.Name</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Stok Durumu:</strong></td>
                                                <td>@(Model.StockQuantity > 0 ? "Stokta" : "Stokta Yok")</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-md-6">
                                    <table class="table table-borderless">
                                        <tbody>
                                            <tr>
                                                <td><strong>Raf Ömrü:</strong></td>
                                                <td>30 Gün</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Saklama Koşulu:</strong></td>
                                                <td>+4°C</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Üretim Yeri:</strong></td>
                                                <td>Manyas, Balıkesir</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Üretim Tarihi:</strong></td>
                                                <td>Günlük</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Sertifika:</strong></td>
                                                <td>ISO 22000</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Reviews Tab -->
                    <div class="tab-pane fade" id="reviews" role="tabpanel">
                        <div class="p-4">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4 class="fw-bold mb-0">Müşteri Yorumları</h4>
                                <button class="btn btn-primary" onclick="showReviewForm()">
                                    <i class="fas fa-plus me-2"></i>Yorum Yap
                                </button>
                            </div>
                            
                            <!-- Review Stats -->
                            <div class="review-stats mb-4">
                                <div class="row align-items-center">
                                    <div class="col-md-3 text-center">
                                        <div class="overall-rating">
                                            <h2 class="text-warning mb-0">4.8</h2>
                                            <div class="stars mb-2">
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                            </div>
                                            <small class="text-muted">24 değerlendirme</small>
                                        </div>
                                    </div>
                                    <div class="col-md-9">
                                        <div class="rating-bars">
                                            <div class="rating-bar d-flex align-items-center mb-2">
                                                <span class="me-2">5</span>
                                                <div class="progress flex-grow-1 me-2" style="height: 8px;">
                                                    <div class="progress-bar bg-warning" style="width: 80%"></div>
                                                </div>
                                                <span class="text-muted">19</span>
                                            </div>
                                            <div class="rating-bar d-flex align-items-center mb-2">
                                                <span class="me-2">4</span>
                                                <div class="progress flex-grow-1 me-2" style="height: 8px;">
                                                    <div class="progress-bar bg-warning" style="width: 15%"></div>
                                                </div>
                                                <span class="text-muted">4</span>
                                            </div>
                                            <div class="rating-bar d-flex align-items-center mb-2">
                                                <span class="me-2">3</span>
                                                <div class="progress flex-grow-1 me-2" style="height: 8px;">
                                                    <div class="progress-bar bg-warning" style="width: 5%"></div>
                                                </div>
                                                <span class="text-muted">1</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Review List -->
                            <div class="review-list">
                                <div class="review-item border-bottom pb-3 mb-3">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <div>
                                            <h6 class="fw-bold mb-1">Ayşe K.</h6>
                                            <div class="stars">
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                            </div>
                                        </div>
                                        <small class="text-muted">2 gün önce</small>
                                    </div>
                                    <p class="mb-0">Harika bir lezzet! Gerçekten taze ve doğal. Kahvaltı sofralarımızın vazgeçilmezi oldu. Kesinlikle tavsiye ederim.</p>
                                </div>

                                <div class="review-item border-bottom pb-3 mb-3">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <div>
                                            <h6 class="fw-bold mb-1">Mehmet D.</h6>
                                            <div class="stars">
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="far fa-star text-warning"></i>
                                            </div>
                                        </div>
                                        <small class="text-muted">1 hafta önce</small>
                                    </div>
                                    <p class="mb-0">Kaliteli ürün, hızlı teslimat. Peynir gerçekten çok lezzetli. Tekrar sipariş vereceğim.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Related Products -->
<section class="section-padding">
    <div class="container">
        <div class="section-title text-center mb-5" data-aos="fade-up">
            <h2>Benzer Ürünler</h2>
            <p>Bu ürünle birlikte alabileceğiniz diğer lezzetler</p>
        </div>
        
        @if (ViewBag.RelatedProducts != null && ((List<manyasligida.Models.Product>)ViewBag.RelatedProducts).Any())
        {
            <div class="row g-4">
                @{
                    var relatedProducts = (List<manyasligida.Models.Product>)ViewBag.RelatedProducts;
                    int delayCounter = 100;
                }
                @foreach (var product in relatedProducts)
                {
                    <div class="col-lg-3 col-md-6" data-aos="fade-up" data-aos-delay="@delayCounter">
                        <div class="card product-card h-100">
                            <div class="product-image">
                                <img src="@product.GetMainImageUrl()" class="card-img-top" alt="@product.Name" loading="lazy">
                                <div class="product-overlay">
                                    <a href="@Url.Action("Detail", "Products", new { id = product.Id })" class="btn btn-primary">İncele</a>
                                    <button class="btn btn-outline-light ms-2" onclick="addToCartFromRelated(@product.Id)" title="Sepete Ekle">
                                        <i class="fas fa-shopping-cart"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body text-center">
                                <h5 class="card-title fw-bold">@product.Name</h5>
                                                        @if (!string.IsNullOrEmpty(product.Description) && product.Description.Length > 50)
                                {
                                    <p class="text-muted">@(product.Description.Substring(0, Math.Min(50, product.Description.Length)))...</p>
                                }
                                else if (!string.IsNullOrEmpty(product.Description))
                                {
                                    <p class="text-muted">@product.Description</p>
                                }
                                else
                                {
                                    <p class="text-muted">@(product.Category?.Name ?? "Lezzetli ürün")</p>
                                }
                                
                                <div class="price-section">
                                    @if (product.OldPrice.HasValue && product.OldPrice > product.Price)
                                    {
                                        <div class="d-flex justify-content-center align-items-center gap-2 mb-1">
                                            <span class="price fw-bold text-primary">₺@product.Price.ToString("0.00")</span>
                                            <span class="old-price text-muted text-decoration-line-through small">₺@product.OldPrice?.ToString("0.00")</span>
                                        </div>
                                        var discountPercent = ((product.OldPrice!.Value - product.Price) / product.OldPrice.Value * 100).ToString("0");
                                        <small class="badge bg-danger">%@discountPercent İndirim</small>
                                    }
                                    else
                                    {
                                        <div class="price fw-bold text-primary">₺@product.Price.ToString("0.00")</div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                    delayCounter += 100;
                }
            </div>
        }
        else
        {
            <div class="row">
                <div class="col-12 text-center">
                    <p class="text-muted">Benzer ürün bulunamadı.</p>
                </div>
            </div>
        }
    </div>
</section>

<!-- Image Modal -->
<div class="modal fade" id="imageModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">@Model.Name</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <img id="modalImage" src="@Model.GetMainImageUrl()" class="img-fluid" alt="@Model.Name">
            </div>
        </div>
    </div>
</div>

<style>
    .page-header {
        position: relative;
        overflow: hidden;
    }

    .breadcrumb-item a {
        text-decoration: none;
    }

    .breadcrumb-item a:hover {
        color: var(--accent-color) !important;
    }

    /* Product Gallery */
    .product-gallery {
        position: relative;
    }

    .main-image-container {
        position: relative;
        border: 1px solid #e9ecef;
        border-radius: var(--border-radius);
        overflow: hidden;
        background: #f8f9fa;
    }

    .main-image {
        width: 100%;
        height: 400px;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .main-image-container:hover .main-image {
        transform: scale(1.05);
    }

    .image-overlay {
        position: absolute;
        top: 10px;
        right: 10px;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .main-image-container:hover .image-overlay {
        opacity: 1;
    }

    .thumbnail-container {
        overflow-x: auto;
    }

    .thumbnail-images {
        min-width: max-content;
    }

    .thumbnail-img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border: 2px solid transparent;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        flex-shrink: 0;
    }

    .thumbnail-img:hover,
    .thumbnail-img.active {
        border-color: var(--primary-color);
        transform: scale(1.05);
    }

    /* Product Info */
    .product-title {
        color: var(--text-color);
        font-size: 2.5rem;
        line-height: 1.2;
    }

    .current-price {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-color);
    }

    .old-price {
        font-size: 1.2rem;
    }

    .detail-item {
        padding: 12px 16px;
        background: #f8f9fa;
        border-radius: var(--border-radius);
        border: 1px solid #e9ecef;
    }

    /* Quantity Selector */
    .quantity-group {
        max-width: 200px;
        border-radius: 25px;
        overflow: hidden;
    }

    .quantity-group .btn {
        border-radius: 0;
        padding: 12px 16px;
    }

    .quantity-group .form-control {
        border: none;
        text-align: center;
        font-weight: 600;
        padding: 12px;
    }

    .quantity-group .form-control:focus {
        box-shadow: none;
    }

    /* Action Buttons */
    .action-buttons .btn {
        border-radius: 25px;
        font-weight: 500;
        padding: 15px 30px;
    }

    .quick-actions .btn {
        border-radius: 20px;
        font-size: 0.9rem;
        padding: 10px 20px;
    }

    .delivery-info .card {
        border-radius: var(--border-radius);
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    }

    /* Tabs */
    .nav-tabs {
        border-bottom: 2px solid #e9ecef;
    }

    .nav-tabs .nav-link {
        border: none;
        color: var(--text-muted);
        font-weight: 500;
        padding: 1rem 2rem;
        border-radius: 25px 25px 0 0;
        margin-right: 5px;
        transition: all 0.3s ease;
    }

    .nav-tabs .nav-link:hover {
        color: var(--primary-color);
        background: rgba(231, 76, 60, 0.1);
    }

    .nav-tabs .nav-link.active {
        background: var(--primary-color);
        color: white;
        border: none;
        transform: translateY(-2px);
    }

    .tab-content {
        border: 1px solid #e9ecef;
        border-top: none;
        border-radius: 0 0 var(--border-radius) var(--border-radius);
        background: white;
    }

    /* Reviews */
    .overall-rating h2 {
        font-size: 3rem;
        font-weight: 700;
    }

    .rating-bars .progress {
        border-radius: 10px;
        background: #e9ecef;
    }

    .review-item {
        padding: 1rem 0;
    }

    /* Product Cards */
    .product-card {
        transition: all 0.3s ease;
        border: none;
        box-shadow: var(--shadow);
        border-radius: var(--border-radius-lg);
    }

    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
    }

    .product-image {
        position: relative;
        overflow: hidden;
        height: 250px;
        border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
    }

    .product-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .product-card:hover .product-image img {
        transform: scale(1.1);
    }

    .product-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(231, 76, 60, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .product-card:hover .product-overlay {
        opacity: 1;
    }

    .price {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--primary-color);
    }

    /* Modal */
    .modal-content {
        border-radius: var(--border-radius-lg);
        border: none;
        box-shadow: var(--shadow-lg);
    }

    .modal-header {
        border-bottom: 1px solid #e9ecef;
        padding: 1.5rem;
    }

    .modal-body {
        padding: 2rem;
    }

    /* Responsive */
    @@media (max-width: 768px) {
        .product-title {
            font-size: 2rem;
        }
        
        .main-image {
            height: 300px;
        }
        
        .thumbnail-img {
            width: 60px;
            height: 60px;
        }
        
        .quantity-group {
            max-width: 100%;
        }
        
        .action-buttons .btn {
            padding: 12px 20px;
        }
    }

    @@media (max-width: 576px) {
        .product-title {
            font-size: 1.5rem;
        }
        
        .main-image {
            height: 250px;
        }
        
        .current-price {
            font-size: 1.5rem;
        }
        
        .nav-tabs .nav-link {
            padding: 0.75rem 1rem;
            font-size: 0.9rem;
        }
    }
</style>

<script>
    function changeImage(thumbnail, imageSrc) {
        // Remove active class from all thumbnails
        document.querySelectorAll('.thumbnail-img').forEach(img => {
            img.classList.remove('active');
        });
        
        // Add active class to clicked thumbnail
        thumbnail.classList.add('active');
        
        // Change main image
        document.getElementById('mainImage').src = imageSrc.replace('~/', '/');
    }

    function decreaseQuantity() {
        const input = document.getElementById('quantity');
        if (input.value > 1) {
            input.value = parseInt(input.value) - 1;
        }
    }

    function increaseQuantity() {
        const input = document.getElementById('quantity');
        if (input.value < 10) {
            input.value = parseInt(input.value) + 1;
        }
    }

    function addToCart(productId) {
        const quantity = document.getElementById('quantity').value;
        const button = event.target;
        const originalText = button.innerHTML;
        
        // Show loading state
        button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Ekleniyor...';
        button.disabled = true;

        // Send AJAX request
        fetch('/Cart/AddToCart', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `productId=${productId}&quantity=${quantity}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                button.innerHTML = '<i class="fas fa-check me-2"></i>Eklendi!';
                button.classList.remove('btn-primary');
                button.classList.add('btn-success');
                
                // Show success message
                showToast(data.message, 'success');
                
                // Update cart count in navbar
                updateCartCount();
            } else {
                button.innerHTML = originalText;
                button.disabled = false;
                showToast(data.message, 'error');
            }
        })
        .catch(error => {
            button.innerHTML = originalText;
            button.disabled = false;
            showToast('Bir hata oluştu', 'error');
        });
    }

    // Benzer ürünler için sepete ekleme fonksiyonu
    function addToCartFromRelated(productId) {
        const button = event.target.closest('button');
        const originalHTML = button.innerHTML;
        
        // Show loading state
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        button.disabled = true;

        // Send AJAX request with default quantity 1
        fetch('/Products/AddToCart', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `productId=${productId}&quantity=1`
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                button.innerHTML = '<i class="fas fa-check"></i>';
                button.classList.remove('btn-outline-light');
                button.classList.add('btn-success');
                
                // Show success message
                showToast(data.message, 'success');
                
                // Update cart count in navbar
                updateCartCount();
                
                // Reset button after 2 seconds
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.classList.remove('btn-success');
                    button.classList.add('btn-outline-light');
                    button.disabled = false;
                }, 2000);
            } else {
                button.innerHTML = originalHTML;
                button.disabled = false;
                showToast(data.message || 'Bir hata oluştu', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            button.innerHTML = originalHTML;
            button.disabled = false;
            showToast('Bir hata oluştu', 'error');
        });
    }

    function updateCartCount() {
        fetch('/Cart/GetCartCount')
            .then(response => response.json())
            .then(data => {
                const cartCount = document.querySelector('.cart-count');
                if (cartCount) {
                    cartCount.textContent = data.cartItemCount;
                    if (data.cartItemCount === 0) {
                        cartCount.style.display = 'none';
                    } else {
                        cartCount.style.display = 'block';
                    }
                }
            });
    }

    function openImageModal() {
        const modal = new bootstrap.Modal(document.getElementById('imageModal'));
        document.getElementById('modalImage').src = document.getElementById('mainImage').src;
        modal.show();
    }

    function addToWishlist() {
        showToast('Ürün favorilere eklendi!', 'success');
    }

    function shareProduct() {
        if (navigator.share) {
            navigator.share({
                title: '@Model.Name - Manyaslı Süt Ürünleri',
                text: 'Harika bir lezzet!',
                url: window.location.href
            });
        } else {
            // Fallback for browsers that don't support Web Share API
            const url = window.location.href;
            const text = '@Model.Name - Manyaslı Süt Ürünleri';
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(`${text}\n${url}`).then(() => {
                    showToast('Link kopyalandı!', 'success');
                });
            } else {
                showToast('Paylaşım özelliği bu tarayıcıda desteklenmiyor.', 'info');
            }
        }
    }

    function showReviewForm() {
        showToast('Yorum formu yakında eklenecek!', 'info');
    }
</script> 